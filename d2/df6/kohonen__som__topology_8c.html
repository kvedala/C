<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.18"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Algorithms_in_C: machine_learning/kohonen_som_topology.c File Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js", "TeX/AMSmath.js", "TeX/AMSsymbols.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML/MathJax.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Algorithms_in_C
   &#160;<span id="projectnumber">1.0.0</span>
   </div>
   <div id="projectbrief">Set of algorithms implemented in C.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.18 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('d2/df6/kohonen__som__topology_8c.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">kohonen_som_topology.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p><a href="https://en.wikipedia.org/wiki/Self-organizing_map">Kohonen self organizing map</a> (topological map)  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;math.h&gt;</code><br />
<code>#include &lt;stdio.h&gt;</code><br />
<code>#include &lt;stdlib.h&gt;</code><br />
<code>#include &lt;time.h&gt;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for kohonen_som_topology.c:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="../../dc/dd4/kohonen__som__topology_8c__incl.svg" width="331" height="127"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/dc8/structarray__3d.html">array_3d</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">to store info regarding 3D arrays  <a href="../../d0/dc8/structarray__3d.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a525335710b53cb064ca56b936120431e"><td class="memItemLeft" align="right" valign="top"><a id="a525335710b53cb064ca56b936120431e"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d2/df6/kohonen__som__topology_8c.html#a525335710b53cb064ca56b936120431e">_USE_MATH_DEFINES</a></td></tr>
<tr class="memdesc:a525335710b53cb064ca56b936120431e"><td class="mdescLeft">&#160;</td><td class="mdescRight">required for MS Visual C <br /></td></tr>
<tr class="separator:a525335710b53cb064ca56b936120431e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:affe776513b24d84b39af8ab0930fef7f"><td class="memItemLeft" align="right" valign="top"><a id="affe776513b24d84b39af8ab0930fef7f"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d2/df6/kohonen__som__topology_8c.html#affe776513b24d84b39af8ab0930fef7f">max</a>(a,  b)&#160;&#160;&#160;(((a) &gt; (b)) ? (a) : (b))</td></tr>
<tr class="memdesc:affe776513b24d84b39af8ab0930fef7f"><td class="mdescLeft">&#160;</td><td class="mdescRight">shorthand for maximum value <br /></td></tr>
<tr class="separator:affe776513b24d84b39af8ab0930fef7f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac6afabdc09a49a433ee19d8a9486056d"><td class="memItemLeft" align="right" valign="top"><a id="ac6afabdc09a49a433ee19d8a9486056d"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d2/df6/kohonen__som__topology_8c.html#ac6afabdc09a49a433ee19d8a9486056d">min</a>(a,  b)&#160;&#160;&#160;(((a) &lt; (b)) ? (a) : (b))</td></tr>
<tr class="memdesc:ac6afabdc09a49a433ee19d8a9486056d"><td class="mdescLeft">&#160;</td><td class="mdescRight">shorthand for minimum value <br /></td></tr>
<tr class="separator:ac6afabdc09a49a433ee19d8a9486056d"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a7237d2cf3b3f9d034477268c1d6631da"><td class="memItemLeft" align="right" valign="top">double *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d2/df6/kohonen__som__topology_8c.html#a7237d2cf3b3f9d034477268c1d6631da">data_3d</a> (const struct <a class="el" href="../../d0/dc8/structarray__3d.html">array_3d</a> *arr, int x, int y, int z)</td></tr>
<tr class="memdesc:a7237d2cf3b3f9d034477268c1d6631da"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function that returns the pointer to (x, y, z) ^th location in the linear 3D array given by:  <a href="../../d2/df6/kohonen__som__topology_8c.html#a7237d2cf3b3f9d034477268c1d6631da">More...</a><br /></td></tr>
<tr class="separator:a7237d2cf3b3f9d034477268c1d6631da"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af5ce14f026d6d231bef29161bac2b485"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d2/df6/kohonen__som__topology_8c.html#af5ce14f026d6d231bef29161bac2b485">_random</a> (double a, double b)</td></tr>
<tr class="memdesc:af5ce14f026d6d231bef29161bac2b485"><td class="mdescLeft">&#160;</td><td class="mdescRight">Helper function to generate a random number in a given interval.  <a href="../../d2/df6/kohonen__som__topology_8c.html#af5ce14f026d6d231bef29161bac2b485">More...</a><br /></td></tr>
<tr class="separator:af5ce14f026d6d231bef29161bac2b485"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6824dc6d973eb3339af7aef5fea78b0c"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d2/df6/kohonen__som__topology_8c.html#a6824dc6d973eb3339af7aef5fea78b0c">save_2d_data</a> (const char *fname, double **X, int num_points, int num_features)</td></tr>
<tr class="memdesc:a6824dc6d973eb3339af7aef5fea78b0c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Save a given n-dimensional data martix to file.  <a href="../../d2/df6/kohonen__som__topology_8c.html#a6824dc6d973eb3339af7aef5fea78b0c">More...</a><br /></td></tr>
<tr class="separator:a6824dc6d973eb3339af7aef5fea78b0c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adee1bc3871c881f6e04cb9e0b1d01158"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d2/df6/kohonen__som__topology_8c.html#adee1bc3871c881f6e04cb9e0b1d01158">save_u_matrix</a> (const char *fname, struct <a class="el" href="../../d0/dc8/structarray__3d.html">array_3d</a> *W)</td></tr>
<tr class="memdesc:adee1bc3871c881f6e04cb9e0b1d01158"><td class="mdescLeft">&#160;</td><td class="mdescRight">Create the distance matrix or <a href="https://en.wikipedia.org/wiki/U-matrix">U-matrix</a> from the trained weights and save to disk.  <a href="../../d2/df6/kohonen__som__topology_8c.html#adee1bc3871c881f6e04cb9e0b1d01158">More...</a><br /></td></tr>
<tr class="separator:adee1bc3871c881f6e04cb9e0b1d01158"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adc22d512c00a9f5799ee067f4fb90b4b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d2/df6/kohonen__som__topology_8c.html#adc22d512c00a9f5799ee067f4fb90b4b">get_min_2d</a> (double **X, int <a class="el" href="../../db/d01/problem__13_2sol1_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>, double *val, int *x_idx, int *y_idx)</td></tr>
<tr class="memdesc:adc22d512c00a9f5799ee067f4fb90b4b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get minimum value and index of the value in a matrix.  <a href="../../d2/df6/kohonen__som__topology_8c.html#adc22d512c00a9f5799ee067f4fb90b4b">More...</a><br /></td></tr>
<tr class="separator:adc22d512c00a9f5799ee067f4fb90b4b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad139de302fa8135a433d9c1bf971b13b"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d2/df6/kohonen__som__topology_8c.html#ad139de302fa8135a433d9c1bf971b13b">update_weights</a> (const double *X, struct <a class="el" href="../../d0/dc8/structarray__3d.html">array_3d</a> *W, double **D, int num_out, int num_features, double alpha, int R)</td></tr>
<tr class="memdesc:ad139de302fa8135a433d9c1bf971b13b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Update weights of the SOM using Kohonen algorithm.  <a href="../../d2/df6/kohonen__som__topology_8c.html#ad139de302fa8135a433d9c1bf971b13b">More...</a><br /></td></tr>
<tr class="separator:ad139de302fa8135a433d9c1bf971b13b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1983dc0f35e734015772e9f8c0ff19f5"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d2/df6/kohonen__som__topology_8c.html#a1983dc0f35e734015772e9f8c0ff19f5">kohonen_som</a> (double **X, struct <a class="el" href="../../d0/dc8/structarray__3d.html">array_3d</a> *W, int num_samples, int num_features, int num_out, double alpha_min)</td></tr>
<tr class="memdesc:a1983dc0f35e734015772e9f8c0ff19f5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Apply incremental algorithm with updating neighborhood and learning rates on all samples in the given datset.  <a href="../../d2/df6/kohonen__som__topology_8c.html#a1983dc0f35e734015772e9f8c0ff19f5">More...</a><br /></td></tr>
<tr class="separator:a1983dc0f35e734015772e9f8c0ff19f5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adb5ded007be1fd666fab9affe6764018"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d2/df6/kohonen__som__topology_8c.html#adb5ded007be1fd666fab9affe6764018">test_2d_classes</a> (double *const *<a class="el" href="../../df/dea/structdata.html">data</a>, int <a class="el" href="../../db/d01/problem__13_2sol1_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>)</td></tr>
<tr class="memdesc:adb5ded007be1fd666fab9affe6764018"><td class="mdescLeft">&#160;</td><td class="mdescRight">Creates a random set of points distributed in four clusters in 3D space with centroids at the points.  <a href="../../d2/df6/kohonen__som__topology_8c.html#adb5ded007be1fd666fab9affe6764018">More...</a><br /></td></tr>
<tr class="separator:adb5ded007be1fd666fab9affe6764018"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1440a7779ac56f47a3f355ce4a8c7da0"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d2/df6/kohonen__som__topology_8c.html#a1440a7779ac56f47a3f355ce4a8c7da0">test1</a> ()</td></tr>
<tr class="memdesc:a1440a7779ac56f47a3f355ce4a8c7da0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Test that creates a random set of points distributed in four clusters in 2D space and trains an SOM that finds the topological pattern.  <a href="../../d2/df6/kohonen__som__topology_8c.html#a1440a7779ac56f47a3f355ce4a8c7da0">More...</a><br /></td></tr>
<tr class="separator:a1440a7779ac56f47a3f355ce4a8c7da0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad9e25202bb8b481461f932668f249dbc"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d2/df6/kohonen__som__topology_8c.html#ad9e25202bb8b481461f932668f249dbc">test_3d_classes1</a> (double *const *<a class="el" href="../../df/dea/structdata.html">data</a>, int <a class="el" href="../../db/d01/problem__13_2sol1_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>)</td></tr>
<tr class="memdesc:ad9e25202bb8b481461f932668f249dbc"><td class="mdescLeft">&#160;</td><td class="mdescRight">Creates a random set of points distributed in four clusters in 3D space with centroids at the points.  <a href="../../d2/df6/kohonen__som__topology_8c.html#ad9e25202bb8b481461f932668f249dbc">More...</a><br /></td></tr>
<tr class="separator:ad9e25202bb8b481461f932668f249dbc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0283886819c7c140a023582b7269e2d0"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d2/df6/kohonen__som__topology_8c.html#a0283886819c7c140a023582b7269e2d0">test2</a> ()</td></tr>
<tr class="memdesc:a0283886819c7c140a023582b7269e2d0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Test that creates a random set of points distributed in 4 clusters in 3D space and trains an SOM that finds the topological pattern.  <a href="../../d2/df6/kohonen__som__topology_8c.html#a0283886819c7c140a023582b7269e2d0">More...</a><br /></td></tr>
<tr class="separator:a0283886819c7c140a023582b7269e2d0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5bb02a8322d717ead1b11182c5f02a3a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d2/df6/kohonen__som__topology_8c.html#a5bb02a8322d717ead1b11182c5f02a3a">test_3d_classes2</a> (double *const *<a class="el" href="../../df/dea/structdata.html">data</a>, int <a class="el" href="../../db/d01/problem__13_2sol1_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>)</td></tr>
<tr class="memdesc:a5bb02a8322d717ead1b11182c5f02a3a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Creates a random set of points distributed in four clusters in 3D space with centroids at the points.  <a href="../../d2/df6/kohonen__som__topology_8c.html#a5bb02a8322d717ead1b11182c5f02a3a">More...</a><br /></td></tr>
<tr class="separator:a5bb02a8322d717ead1b11182c5f02a3a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6d0455dd5c30adda100e95f0423c786e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d2/df6/kohonen__som__topology_8c.html#a6d0455dd5c30adda100e95f0423c786e">test3</a> ()</td></tr>
<tr class="memdesc:a6d0455dd5c30adda100e95f0423c786e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Test that creates a random set of points distributed in eight clusters in 3D space and trains an SOM that finds the topological pattern.  <a href="../../d2/df6/kohonen__som__topology_8c.html#a6d0455dd5c30adda100e95f0423c786e">More...</a><br /></td></tr>
<tr class="separator:a6d0455dd5c30adda100e95f0423c786e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2256c10b16edba377b64a44b6c656908"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d2/df6/kohonen__som__topology_8c.html#a2256c10b16edba377b64a44b6c656908">get_clock_diff</a> (clock_t start_t, clock_t end_t)</td></tr>
<tr class="memdesc:a2256c10b16edba377b64a44b6c656908"><td class="mdescLeft">&#160;</td><td class="mdescRight">Convert clock cycle difference to time in seconds.  <a href="../../d2/df6/kohonen__som__topology_8c.html#a2256c10b16edba377b64a44b6c656908">More...</a><br /></td></tr>
<tr class="separator:a2256c10b16edba377b64a44b6c656908"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3c04138a5bfe5d72780bb7e82a18e627"><td class="memItemLeft" align="right" valign="top"><a id="a3c04138a5bfe5d72780bb7e82a18e627"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d2/df6/kohonen__som__topology_8c.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a> (int argc, char **argv)</td></tr>
<tr class="memdesc:a3c04138a5bfe5d72780bb7e82a18e627"><td class="mdescLeft">&#160;</td><td class="mdescRight">Main function. <br /></td></tr>
<tr class="separator:a3c04138a5bfe5d72780bb7e82a18e627"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p><a href="https://en.wikipedia.org/wiki/Self-organizing_map">Kohonen self organizing map</a> (topological map) </p>
<dl class="section author"><dt>Author</dt><dd><a href="https://github.com/kvedala">Krishna Vedala</a> This example implements a powerful unsupervised learning algorithm called as a self organizing map. The algorithm creates a connected network of weights that closely follows the given data points. This thus creates a topological map of the given data i.e., it maintains the relationship between varipus data points in a much higher dimesional space by creating an equivalent in a 2-dimensional space. <img src="https://raw.githubusercontent.com/TheAlgorithms/C/docs/images/machine_learning/kohonen/2D_Kohonen_SOM.svg" alt="Trained topological maps for the test cases in the program" style="pointer-events: none;" class="inline"/> </dd></dl>
<dl class="section warning"><dt>Warning</dt><dd>MSVC 2019 compiler generates code that does not execute as expected. However, MinGW, Clang for GCC and Clang for MSVC compilers on windows perform as expected. Any insights and suggestions should be directed to the author. </dd></dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="../../d0/d46/kohonen__som__trace_8c.html" title="Kohonen self organizing map (data tracing)">kohonen_som_trace.c</a> </dd></dl>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="af5ce14f026d6d231bef29161bac2b485"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af5ce14f026d6d231bef29161bac2b485">&#9670;&nbsp;</a></span>_random()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double _random </td>
          <td>(</td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>a</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>b</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Helper function to generate a random number in a given interval. </p>
<p><br  />
 Steps:</p><ol type="1">
<li><code>r1 = rand() % 100</code> gets a random number between 0 and 99</li>
<li><code>r2 = r1 / 100</code> converts random number to be between 0 and 0.99</li>
<li>scale and offset the random number to given range of \([a,b)\) <p class="formulaDsp">
\[ y = (b - a) \times \frac{\text{(random number between 0 and RAND_MAX)} \; \text{mod}\; 100}{100} + a \]
</p>
</li>
</ol>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">a</td><td>lower limit </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">b</td><td>upper limit </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>random number in the range \([a,b)\) </dd></dl>
<div class="fragment"><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;{</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    <span class="keywordflow">return</span> ((b - a) * (rand() % 100) / 100.f) + a;</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a7237d2cf3b3f9d034477268c1d6631da"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7237d2cf3b3f9d034477268c1d6631da">&#9670;&nbsp;</a></span>data_3d()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double* data_3d </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="../../d0/dc8/structarray__3d.html">array_3d</a> *&#160;</td>
          <td class="paramname"><em>arr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>x</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>y</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>z</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Function that returns the pointer to (x, y, z) ^th location in the linear 3D array given by: </p>
<p class="formulaDsp">
\[ X_{i,j,k} = i\times M\times N + j\times N + k \]
</p>
<p> where \(L\), \(M\) and \(N\) are the 3D matrix dimensions. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">arr</td><td>pointer to <a class="el" href="../../d0/dc8/structarray__3d.html" title="to store info regarding 3D arrays">array_3d</a> structure </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">x</td><td>first index </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">y</td><td>second index </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">z</td><td>third index </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>pointer to (x,y,z)^th location of data </dd></dl>
<div class="fragment"><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;{</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    <span class="keywordtype">int</span> offset = (x * arr-&gt;<a class="code" href="../../d0/dc8/structarray__3d.html#aa431cc0a41fd379270dbd2b0e3ac1b45">dim2</a> * arr-&gt;<a class="code" href="../../d0/dc8/structarray__3d.html#ad823bd5424a0fc158da52a0497d8c10a">dim3</a>) + (y * arr-&gt;<a class="code" href="../../d0/dc8/structarray__3d.html#ad823bd5424a0fc158da52a0497d8c10a">dim3</a>) + z;</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    <span class="keywordflow">return</span> arr-&gt;<a class="code" href="../../d0/dc8/structarray__3d.html#ac8967b2c72769f839c09fb4cebb4339f">data</a> + offset;</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a2256c10b16edba377b64a44b6c656908"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2256c10b16edba377b64a44b6c656908">&#9670;&nbsp;</a></span>get_clock_diff()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double get_clock_diff </td>
          <td>(</td>
          <td class="paramtype">clock_t&#160;</td>
          <td class="paramname"><em>start_t</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">clock_t&#160;</td>
          <td class="paramname"><em>end_t</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Convert clock cycle difference to time in seconds. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">start_t</td><td>start clock </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">end_t</td><td>end clock </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>time difference in seconds </dd></dl>
<div class="fragment"><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;{</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;    <span class="keywordflow">return</span> (<span class="keywordtype">double</span>)(end_t - start_t) / (<span class="keywordtype">double</span>)CLOCKS_PER_SEC;</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a id="adc22d512c00a9f5799ee067f4fb90b4b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adc22d512c00a9f5799ee067f4fb90b4b">&#9670;&nbsp;</a></span>get_min_2d()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void get_min_2d </td>
          <td>(</td>
          <td class="paramtype">double **&#160;</td>
          <td class="paramname"><em>X</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>N</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>val</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>x_idx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>y_idx</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get minimum value and index of the value in a matrix. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">X</td><td>matrix to search </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">N</td><td>number of points in the vector </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">val</td><td>minimum value found </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">x_idx</td><td>x-index where minimum value was found </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">y_idx</td><td>y-index where minimum value was found </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;{</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    val[0] = INFINITY;  <span class="comment">// initial min value</span></div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160; </div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="../../db/d01/problem__13_2sol1_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>; i++)  <span class="comment">// traverse each x-index</span></div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    {</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; <a class="code" href="../../db/d01/problem__13_2sol1_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>; j++)  <span class="comment">// traverse each y-index</span></div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;        {</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;            <span class="keywordflow">if</span> (X[i][j] &lt; val[0])  <span class="comment">// if a lower value is found</span></div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;            {                      <span class="comment">// save the value and its index</span></div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;                x_idx[0] = i;</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;                y_idx[0] = j;</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;                val[0] = X[i][j];</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;            }</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;        }</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    }</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a1983dc0f35e734015772e9f8c0ff19f5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1983dc0f35e734015772e9f8c0ff19f5">&#9670;&nbsp;</a></span>kohonen_som()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kohonen_som </td>
          <td>(</td>
          <td class="paramtype">double **&#160;</td>
          <td class="paramname"><em>X</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="../../d0/dc8/structarray__3d.html">array_3d</a> *&#160;</td>
          <td class="paramname"><em>W</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>num_samples</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>num_features</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>num_out</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>alpha_min</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Apply incremental algorithm with updating neighborhood and learning rates on all samples in the given datset. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">X</td><td>data set </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">W</td><td>weights matrix </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">num_samples</td><td>number of output points </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">num_features</td><td>number of features per input sample </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">num_out</td><td>number of output points </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">alpha_min</td><td>terminal value of alpha </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;{</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;    <span class="keywordtype">int</span> R = num_out &gt;&gt; 2, iter = 0;</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;    <span class="keywordtype">double</span> **D = (<span class="keywordtype">double</span> **)malloc(num_out * <span class="keyword">sizeof</span>(<span class="keywordtype">double</span> *));</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; num_out; i++)</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;        D[i] = (<span class="keywordtype">double</span> *)malloc(num_out * <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160; </div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;    <span class="keywordtype">double</span> dmin = 1.f;  <span class="comment">// average minimum distance of all samples</span></div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160; </div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;    <span class="comment">// Loop alpha from 1 to slpha_min</span></div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">double</span> alpha = 1.f; alpha &gt; alpha_min &amp;&amp; dmin &gt; 1e-3;</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;         alpha -= 0.001, iter++)</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;    {</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;        dmin = 0.f;</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;        <span class="comment">// Loop for each sample pattern in the data set</span></div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> sample = 0; sample &lt; num_samples; sample++)</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;        {</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;            <span class="comment">// update weights for the current input pattern sample</span></div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;            dmin += <a class="code" href="../../d2/df6/kohonen__som__topology_8c.html#ad139de302fa8135a433d9c1bf971b13b">update_weights</a>(X[sample], W, D, num_out, num_features,</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;                                   alpha, R);</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;        }</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160; </div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;        <span class="comment">// every 20th iteration, reduce the neighborhood range</span></div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;        <span class="keywordflow">if</span> (iter % 100 == 0 &amp;&amp; R &gt; 1)</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;            R--;</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160; </div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;        dmin /= num_samples;</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;        printf(<span class="stringliteral">&quot;iter: %5d\t alpha: %.4g\t R: %d\td_min: %.4g\r&quot;</span>, iter, alpha, R,</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;               dmin);</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;    }</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;    putchar(<span class="charliteral">&#39;\n&#39;</span>);</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160; </div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; num_out; i++) free(D[i]);</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;    free(D);</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="../../d2/df6/kohonen__som__topology_8c_a1983dc0f35e734015772e9f8c0ff19f5_cgraph.svg" width="412" height="88"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a6824dc6d973eb3339af7aef5fea78b0c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6824dc6d973eb3339af7aef5fea78b0c">&#9670;&nbsp;</a></span>save_2d_data()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int save_2d_data </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>fname</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double **&#160;</td>
          <td class="paramname"><em>X</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>num_points</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>num_features</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Save a given n-dimensional data martix to file. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">fname</td><td>filename to save in (gets overwriten without confirmation) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">X</td><td>matrix to save </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">num_points</td><td>rows in the matrix = number of points </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">num_features</td><td>columns in the matrix = dimensions of points </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 if all ok </dd>
<dd>
-1 if file creation failed </dd></dl>
<div class="fragment"><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;{</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    FILE *fp = fopen(fname, <span class="stringliteral">&quot;wt&quot;</span>);</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    <span class="keywordflow">if</span> (!fp)  <span class="comment">// error with fopen</span></div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    {</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;        <span class="keywordtype">char</span> msg[120];</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;        sprintf(msg, <span class="stringliteral">&quot;File error (%s): &quot;</span>, fname);</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;        perror(msg);</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;        <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    }</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160; </div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; num_points; i++)  <span class="comment">// for each point in the array</span></div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    {</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; num_features; j++)  <span class="comment">// for each feature in the array</span></div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;        {</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;            fprintf(fp, <span class="stringliteral">&quot;%.4g&quot;</span>, X[i][j]);  <span class="comment">// print the feature value</span></div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;            <span class="keywordflow">if</span> (j &lt; num_features - 1)      <span class="comment">// if not the last feature</span></div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;                fputc(<span class="charliteral">&#39;,&#39;</span>, fp);            <span class="comment">// suffix comma</span></div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;        }</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;        <span class="keywordflow">if</span> (i &lt; num_points - 1)  <span class="comment">// if not the last row</span></div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;            fputc(<span class="charliteral">&#39;\n&#39;</span>, fp);     <span class="comment">// start a new line</span></div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    }</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    fclose(fp);</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a id="adee1bc3871c881f6e04cb9e0b1d01158"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adee1bc3871c881f6e04cb9e0b1d01158">&#9670;&nbsp;</a></span>save_u_matrix()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int save_u_matrix </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>fname</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="../../d0/dc8/structarray__3d.html">array_3d</a> *&#160;</td>
          <td class="paramname"><em>W</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Create the distance matrix or <a href="https://en.wikipedia.org/wiki/U-matrix">U-matrix</a> from the trained weights and save to disk. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">fname</td><td>filename to save in (gets overwriten without confirmation) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">W</td><td>model matrix to save </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 if all ok </dd>
<dd>
-1 if file creation failed </dd></dl>
<div class="fragment"><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;{</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    FILE *fp = fopen(fname, <span class="stringliteral">&quot;wt&quot;</span>);</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    <span class="keywordflow">if</span> (!fp)  <span class="comment">// error with fopen</span></div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    {</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;        <span class="keywordtype">char</span> msg[120];</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;        sprintf(msg, <span class="stringliteral">&quot;File error (%s): &quot;</span>, fname);</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;        perror(msg);</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;        <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    }</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160; </div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    <span class="keywordtype">int</span> R = <a class="code" href="../../d2/df6/kohonen__som__topology_8c.html#affe776513b24d84b39af8ab0930fef7f">max</a>(W-&gt;<a class="code" href="../../d0/dc8/structarray__3d.html#ad5d3ee546eea3c05dc8f0dc90ec194f4">dim1</a> &gt;&gt; 3, 2); <span class="comment">/* neighborhood range */</span></div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160; </div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; W-&gt;<a class="code" href="../../d0/dc8/structarray__3d.html#ad5d3ee546eea3c05dc8f0dc90ec194f4">dim1</a>; i++)  <span class="comment">// for each x</span></div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    {</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; W-&gt;<a class="code" href="../../d0/dc8/structarray__3d.html#aa431cc0a41fd379270dbd2b0e3ac1b45">dim2</a>; j++)  <span class="comment">// for each y</span></div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;        {</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;            <span class="keywordtype">double</span> distance = 0.f;</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;            <span class="keywordtype">int</span> k;</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160; </div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;            <span class="keywordtype">int</span> from_x = <a class="code" href="../../d2/df6/kohonen__som__topology_8c.html#affe776513b24d84b39af8ab0930fef7f">max</a>(0, i - R);</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;            <span class="keywordtype">int</span> to_x = <a class="code" href="../../d2/df6/kohonen__som__topology_8c.html#ac6afabdc09a49a433ee19d8a9486056d">min</a>(W-&gt;<a class="code" href="../../d0/dc8/structarray__3d.html#ad5d3ee546eea3c05dc8f0dc90ec194f4">dim1</a>, i + R + 1);</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;            <span class="keywordtype">int</span> from_y = <a class="code" href="../../d2/df6/kohonen__som__topology_8c.html#affe776513b24d84b39af8ab0930fef7f">max</a>(0, j - R);</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;            <span class="keywordtype">int</span> to_y = <a class="code" href="../../d2/df6/kohonen__som__topology_8c.html#ac6afabdc09a49a433ee19d8a9486056d">min</a>(W-&gt;<a class="code" href="../../d0/dc8/structarray__3d.html#aa431cc0a41fd379270dbd2b0e3ac1b45">dim2</a>, j + R + 1);</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;            <span class="keywordtype">int</span> l;</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;<span class="preprocessor">#ifdef _OPENMP</span></div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;<span class="preprocessor">#pragma omp parallel for reduction(+ : distance)</span></div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;            <span class="keywordflow">for</span> (l = from_x; l &lt; to_x; l++)  <span class="comment">// scan neighborhoor in x</span></div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;            {</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> m = from_y; m &lt; to_y; m++)  <span class="comment">// scan neighborhood in y</span></div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;                {</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;                    <span class="keywordtype">double</span> d = 0.f;</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;                    <span class="keywordflow">for</span> (k = 0; k &lt; W-&gt;<a class="code" href="../../d0/dc8/structarray__3d.html#ad823bd5424a0fc158da52a0497d8c10a">dim3</a>; k++)  <span class="comment">// for each feature</span></div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;                    {</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;                        <span class="keywordtype">double</span> *w1 = <a class="code" href="../../d2/df6/kohonen__som__topology_8c.html#a7237d2cf3b3f9d034477268c1d6631da">data_3d</a>(W, i, j, k);</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;                        <span class="keywordtype">double</span> *w2 = <a class="code" href="../../d2/df6/kohonen__som__topology_8c.html#a7237d2cf3b3f9d034477268c1d6631da">data_3d</a>(W, l, m, k);</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;                        d += (w1[0] - w2[0]) * (w1[0] - w2[0]);</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;                        <span class="comment">// distance += w1[0] * w1[0];</span></div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;                    }</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;                    distance += sqrt(d);</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;                    <span class="comment">// distance += d;</span></div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;                }</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;            }</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160; </div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;            distance /= R * R;              <span class="comment">// mean distance from neighbors</span></div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;            fprintf(fp, <span class="stringliteral">&quot;%.4g&quot;</span>, distance);  <span class="comment">// print the mean separation</span></div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;            <span class="keywordflow">if</span> (j &lt; W-&gt;dim2 - 1)            <span class="comment">// if not the last column</span></div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;                fputc(<span class="charliteral">&#39;,&#39;</span>, fp);             <span class="comment">// suffix comma</span></div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;        }</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;        <span class="keywordflow">if</span> (i &lt; W-&gt;dim1 - 1)  <span class="comment">// if not the last row</span></div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;            fputc(<span class="charliteral">&#39;\n&#39;</span>, fp);  <span class="comment">// start a new line</span></div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;    }</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    fclose(fp);</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="../../d2/df6/kohonen__som__topology_8c_adee1bc3871c881f6e04cb9e0b1d01158_cgraph.svg" width="234" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a1440a7779ac56f47a3f355ce4a8c7da0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1440a7779ac56f47a3f355ce4a8c7da0">&#9670;&nbsp;</a></span>test1()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void test1 </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Test that creates a random set of points distributed in four clusters in 2D space and trains an SOM that finds the topological pattern. </p>
<p>The following <a href="https://en.wikipedia.org/wiki/Comma-separated_values">CSV</a> files are created to validate the execution:</p><ul>
<li><code>test1.csv</code>: random test samples points with a circular pattern</li>
<li><code>w11.csv</code>: initial random U-matrix</li>
<li><code>w12.csv</code>: trained SOM U-matrix </li>
</ul>
<div class="fragment"><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;{</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;    <span class="keywordtype">int</span> j, <a class="code" href="../../db/d01/problem__13_2sol1_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a> = 300;</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;    <span class="keywordtype">int</span> features = 2;</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;    <span class="keywordtype">int</span> num_out = 30;  <span class="comment">// image size - N x N</span></div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160; </div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;    <span class="comment">// 2D space, hence size = number of rows * 2</span></div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;    <span class="keywordtype">double</span> **X = (<span class="keywordtype">double</span> **)malloc(<a class="code" href="../../db/d01/problem__13_2sol1_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a> * <span class="keyword">sizeof</span>(<span class="keywordtype">double</span> *));</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160; </div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;    <span class="comment">// cluster nodex in &#39;x&#39; * cluster nodes in &#39;y&#39; * 2</span></div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;    <span class="keyword">struct </span><a class="code" href="../../d0/dc8/structarray__3d.html">array_3d</a> W;</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;    W.<a class="code" href="../../d0/dc8/structarray__3d.html#ad5d3ee546eea3c05dc8f0dc90ec194f4">dim1</a> = num_out;</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;    W.dim2 = num_out;</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;    W.dim3 = features;</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;    W.data = (<span class="keywordtype">double</span> *)malloc(num_out * num_out * features *</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;                              <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));  <span class="comment">// assign rows</span></div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160; </div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="../../d2/df6/kohonen__som__topology_8c.html#affe776513b24d84b39af8ab0930fef7f">max</a>(num_out, <a class="code" href="../../db/d01/problem__13_2sol1_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>); i++)  <span class="comment">// loop till max(N, num_out)</span></div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;    {</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;        <span class="keywordflow">if</span> (i &lt; <a class="code" href="../../db/d01/problem__13_2sol1_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>)  <span class="comment">// only add new arrays if i &lt; N</span></div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;            X[i] = (<span class="keywordtype">double</span> *)malloc(features * <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;        <span class="keywordflow">if</span> (i &lt; num_out)  <span class="comment">// only add new arrays if i &lt; num_out</span></div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;        {</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; num_out; k++)</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;            {</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;<span class="preprocessor">#ifdef _OPENMP</span></div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;<span class="preprocessor">#pragma omp for</span></div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;                <span class="comment">// preallocate with random initial weights</span></div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;                <span class="keywordflow">for</span> (j = 0; j &lt; features; j++)</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;                {</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;                    <span class="keywordtype">double</span> *w = <a class="code" href="../../d2/df6/kohonen__som__topology_8c.html#a7237d2cf3b3f9d034477268c1d6631da">data_3d</a>(&amp;W, i, k, j);</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;                    w[0] = <a class="code" href="../../d2/df6/kohonen__som__topology_8c.html#af5ce14f026d6d231bef29161bac2b485">_random</a>(-5, 5);</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;                }</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;            }</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;        }</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;    }</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160; </div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;    <a class="code" href="../../d2/df6/kohonen__som__topology_8c.html#adb5ded007be1fd666fab9affe6764018">test_2d_classes</a>(X, <a class="code" href="../../db/d01/problem__13_2sol1_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>);  <span class="comment">// create test data around circumference of a circle</span></div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;    <a class="code" href="../../d2/df6/kohonen__som__topology_8c.html#a6824dc6d973eb3339af7aef5fea78b0c">save_2d_data</a>(<span class="stringliteral">&quot;test1.csv&quot;</span>, X, <a class="code" href="../../db/d01/problem__13_2sol1_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>, features);  <span class="comment">// save test data points</span></div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;    <a class="code" href="../../d2/df6/kohonen__som__topology_8c.html#adee1bc3871c881f6e04cb9e0b1d01158">save_u_matrix</a>(<span class="stringliteral">&quot;w11.csv&quot;</span>, &amp;W);               <span class="comment">// save initial random weights</span></div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;    <a class="code" href="../../d2/df6/kohonen__som__topology_8c.html#a1983dc0f35e734015772e9f8c0ff19f5">kohonen_som</a>(X, &amp;W, <a class="code" href="../../db/d01/problem__13_2sol1_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>, features, num_out, 1e-4);  <span class="comment">// train the SOM</span></div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;    <a class="code" href="../../d2/df6/kohonen__som__topology_8c.html#adee1bc3871c881f6e04cb9e0b1d01158">save_u_matrix</a>(<span class="stringliteral">&quot;w12.csv&quot;</span>, &amp;W);  <span class="comment">// save the resultant weights</span></div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160; </div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="../../db/d01/problem__13_2sol1_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>; i++) free(X[i]);</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;    free(X);</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;    free(W.data);</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="../../d2/df6/kohonen__som__topology_8c_a1440a7779ac56f47a3f355ce4a8c7da0_cgraph.svg" width="526" height="270"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a0283886819c7c140a023582b7269e2d0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0283886819c7c140a023582b7269e2d0">&#9670;&nbsp;</a></span>test2()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void test2 </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Test that creates a random set of points distributed in 4 clusters in 3D space and trains an SOM that finds the topological pattern. </p>
<p>The following <a href="https://en.wikipedia.org/wiki/Comma-separated_values">CSV</a> files are created to validate the execution:</p><ul>
<li><code>test2.csv</code>: random test samples points</li>
<li><code>w21.csv</code>: initial random U-matrix</li>
<li><code>w22.csv</code>: trained SOM U-matrix </li>
</ul>
<div class="fragment"><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;{</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;    <span class="keywordtype">int</span> j, <a class="code" href="../../db/d01/problem__13_2sol1_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a> = 500;</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;    <span class="keywordtype">int</span> features = 3;</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;    <span class="keywordtype">int</span> num_out = 30;  <span class="comment">// image size - N x N</span></div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160; </div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;    <span class="comment">// 3D space, hence size = number of rows * 3</span></div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;    <span class="keywordtype">double</span> **X = (<span class="keywordtype">double</span> **)malloc(<a class="code" href="../../db/d01/problem__13_2sol1_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a> * <span class="keyword">sizeof</span>(<span class="keywordtype">double</span> *));</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160; </div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;    <span class="comment">// cluster nodex in &#39;x&#39; * cluster nodes in &#39;y&#39; * 2</span></div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;    <span class="keyword">struct </span><a class="code" href="../../d0/dc8/structarray__3d.html">array_3d</a> W;</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;    W.<a class="code" href="../../d0/dc8/structarray__3d.html#ad5d3ee546eea3c05dc8f0dc90ec194f4">dim1</a> = num_out;</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;    W.dim2 = num_out;</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;    W.dim3 = features;</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;    W.data = (<span class="keywordtype">double</span> *)malloc(num_out * num_out * features *</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;                              <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));  <span class="comment">// assign rows</span></div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160; </div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="../../d2/df6/kohonen__som__topology_8c.html#affe776513b24d84b39af8ab0930fef7f">max</a>(num_out, <a class="code" href="../../db/d01/problem__13_2sol1_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>); i++)  <span class="comment">// loop till max(N, num_out)</span></div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;    {</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;        <span class="keywordflow">if</span> (i &lt; <a class="code" href="../../db/d01/problem__13_2sol1_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>)  <span class="comment">// only add new arrays if i &lt; N</span></div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;            X[i] = (<span class="keywordtype">double</span> *)malloc(features * <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;        <span class="keywordflow">if</span> (i &lt; num_out)  <span class="comment">// only add new arrays if i &lt; num_out</span></div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;        {</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; num_out; k++)</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;            {</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;<span class="preprocessor">#ifdef _OPENMP</span></div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;<span class="preprocessor">#pragma omp for</span></div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;                <span class="keywordflow">for</span> (j = 0; j &lt; features; j++)</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;                {  <span class="comment">// preallocate with random initial weights</span></div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;                    <span class="keywordtype">double</span> *w = <a class="code" href="../../d2/df6/kohonen__som__topology_8c.html#a7237d2cf3b3f9d034477268c1d6631da">data_3d</a>(&amp;W, i, k, j);</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;                    w[0] = <a class="code" href="../../d2/df6/kohonen__som__topology_8c.html#af5ce14f026d6d231bef29161bac2b485">_random</a>(-5, 5);</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;                }</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;            }</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;        }</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;    }</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160; </div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;    <a class="code" href="../../d2/df6/kohonen__som__topology_8c.html#ad9e25202bb8b481461f932668f249dbc">test_3d_classes1</a>(X, <a class="code" href="../../db/d01/problem__13_2sol1_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>);                     <span class="comment">// create test data</span></div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;    <a class="code" href="../../d2/df6/kohonen__som__topology_8c.html#a6824dc6d973eb3339af7aef5fea78b0c">save_2d_data</a>(<span class="stringliteral">&quot;test2.csv&quot;</span>, X, <a class="code" href="../../db/d01/problem__13_2sol1_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>, features);  <span class="comment">// save test data points</span></div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;    <a class="code" href="../../d2/df6/kohonen__som__topology_8c.html#adee1bc3871c881f6e04cb9e0b1d01158">save_u_matrix</a>(<span class="stringliteral">&quot;w21.csv&quot;</span>, &amp;W);               <span class="comment">// save initial random weights</span></div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;    <a class="code" href="../../d2/df6/kohonen__som__topology_8c.html#a1983dc0f35e734015772e9f8c0ff19f5">kohonen_som</a>(X, &amp;W, <a class="code" href="../../db/d01/problem__13_2sol1_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>, features, num_out, 1e-4);  <span class="comment">// train the SOM</span></div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;    <a class="code" href="../../d2/df6/kohonen__som__topology_8c.html#adee1bc3871c881f6e04cb9e0b1d01158">save_u_matrix</a>(<span class="stringliteral">&quot;w22.csv&quot;</span>, &amp;W);  <span class="comment">// save the resultant weights</span></div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160; </div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="../../db/d01/problem__13_2sol1_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>; i++) free(X[i]);</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;    free(X);</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;    free(W.data);</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="../../d2/df6/kohonen__som__topology_8c_a0283886819c7c140a023582b7269e2d0_cgraph.svg" width="532" height="271"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a6d0455dd5c30adda100e95f0423c786e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6d0455dd5c30adda100e95f0423c786e">&#9670;&nbsp;</a></span>test3()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void test3 </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Test that creates a random set of points distributed in eight clusters in 3D space and trains an SOM that finds the topological pattern. </p>
<p>The following <a href="https://en.wikipedia.org/wiki/Comma-separated_values">CSV</a> files are created to validate the execution:</p><ul>
<li><code>test3.csv</code>: random test samples points</li>
<li><code>w31.csv</code>: initial random U-matrix</li>
<li><code>w32.csv</code>: trained SOM U-matrix </li>
</ul>
<div class="fragment"><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;{</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;    <span class="keywordtype">int</span> j, <a class="code" href="../../db/d01/problem__13_2sol1_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a> = 500;</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;    <span class="keywordtype">int</span> features = 3;</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;    <span class="keywordtype">int</span> num_out = 30;</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;    <span class="keywordtype">double</span> **X = (<span class="keywordtype">double</span> **)malloc(<a class="code" href="../../db/d01/problem__13_2sol1_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a> * <span class="keyword">sizeof</span>(<span class="keywordtype">double</span> *));</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160; </div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;    <span class="comment">// cluster nodex in &#39;x&#39; * cluster nodes in &#39;y&#39; * 2</span></div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;    <span class="keyword">struct </span><a class="code" href="../../d0/dc8/structarray__3d.html">array_3d</a> W;</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;    W.<a class="code" href="../../d0/dc8/structarray__3d.html#ad5d3ee546eea3c05dc8f0dc90ec194f4">dim1</a> = num_out;</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;    W.dim2 = num_out;</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;    W.dim3 = features;</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;    W.data = (<span class="keywordtype">double</span> *)malloc(num_out * num_out * features *</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;                              <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));  <span class="comment">// assign rows</span></div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160; </div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="../../d2/df6/kohonen__som__topology_8c.html#affe776513b24d84b39af8ab0930fef7f">max</a>(num_out, <a class="code" href="../../db/d01/problem__13_2sol1_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>); i++)  <span class="comment">// loop till max(N, num_out)</span></div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;    {</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;        <span class="keywordflow">if</span> (i &lt; <a class="code" href="../../db/d01/problem__13_2sol1_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>)  <span class="comment">// only add new arrays if i &lt; N</span></div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;            X[i] = (<span class="keywordtype">double</span> *)malloc(features * <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;        <span class="keywordflow">if</span> (i &lt; num_out)  <span class="comment">// only add new arrays if i &lt; num_out</span></div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;        {</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; num_out; k++)</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;            {</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;<span class="preprocessor">#ifdef _OPENMP</span></div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;<span class="preprocessor">#pragma omp for</span></div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;                <span class="comment">// preallocate with random initial weights</span></div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;                <span class="keywordflow">for</span> (j = 0; j &lt; features; j++)</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;                {</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;                    <span class="keywordtype">double</span> *w = <a class="code" href="../../d2/df6/kohonen__som__topology_8c.html#a7237d2cf3b3f9d034477268c1d6631da">data_3d</a>(&amp;W, i, k, j);</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;                    w[0] = <a class="code" href="../../d2/df6/kohonen__som__topology_8c.html#af5ce14f026d6d231bef29161bac2b485">_random</a>(-5, 5);</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;                }</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;            }</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;        }</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;    }</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160; </div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;    <a class="code" href="../../d2/df6/kohonen__som__topology_8c.html#a5bb02a8322d717ead1b11182c5f02a3a">test_3d_classes2</a>(X, <a class="code" href="../../db/d01/problem__13_2sol1_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>);  <span class="comment">// create test data around the lamniscate</span></div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;    <a class="code" href="../../d2/df6/kohonen__som__topology_8c.html#a6824dc6d973eb3339af7aef5fea78b0c">save_2d_data</a>(<span class="stringliteral">&quot;test3.csv&quot;</span>, X, <a class="code" href="../../db/d01/problem__13_2sol1_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>, features);  <span class="comment">// save test data points</span></div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;    <a class="code" href="../../d2/df6/kohonen__som__topology_8c.html#adee1bc3871c881f6e04cb9e0b1d01158">save_u_matrix</a>(<span class="stringliteral">&quot;w31.csv&quot;</span>, &amp;W);               <span class="comment">// save initial random weights</span></div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;    <a class="code" href="../../d2/df6/kohonen__som__topology_8c.html#a1983dc0f35e734015772e9f8c0ff19f5">kohonen_som</a>(X, &amp;W, <a class="code" href="../../db/d01/problem__13_2sol1_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>, features, num_out, 0.01);  <span class="comment">// train the SOM</span></div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;    <a class="code" href="../../d2/df6/kohonen__som__topology_8c.html#adee1bc3871c881f6e04cb9e0b1d01158">save_u_matrix</a>(<span class="stringliteral">&quot;w32.csv&quot;</span>, &amp;W);  <span class="comment">// save the resultant weights</span></div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160; </div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="../../db/d01/problem__13_2sol1_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>; i++) free(X[i]);</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;    free(X);</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;    free(W.data);</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="../../d2/df6/kohonen__som__topology_8c_a6d0455dd5c30adda100e95f0423c786e_cgraph.svg" width="532" height="271"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="adb5ded007be1fd666fab9affe6764018"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adb5ded007be1fd666fab9affe6764018">&#9670;&nbsp;</a></span>test_2d_classes()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void test_2d_classes </td>
          <td>(</td>
          <td class="paramtype">double *const *&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>N</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Creates a random set of points distributed in four clusters in 3D space with centroids at the points. </p>
<ul>
<li>\((0,5, 0.5, 0.5)\)</li>
<li>\((0,5,-0.5, -0.5)\)</li>
<li>\((-0,5, 0.5, 0.5)\)</li>
<li>\((-0,5,-0.5, -0.5)\)</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">data</td><td>matrix to store data in </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">N</td><td>number of points required </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;{</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> R = 0.3;  <span class="comment">// radius of cluster</span></div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;    <span class="keywordtype">int</span> i;</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> num_classes = 4;</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> centres[][2] = {</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;        <span class="comment">// centres of each class cluster</span></div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;        {.5, .5},   <span class="comment">// centre of class 1</span></div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;        {.5, -.5},  <span class="comment">// centre of class 2</span></div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;        {-.5, .5},  <span class="comment">// centre of class 3</span></div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;        {-.5, -.5}  <span class="comment">// centre of class 4</span></div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;    };</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160; </div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;<span class="preprocessor">#ifdef _OPENMP</span></div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;<span class="preprocessor">#pragma omp for</span></div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;    <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="../../db/d01/problem__13_2sol1_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>; i++)</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;    {</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;        <span class="keywordtype">int</span> <span class="keyword">class </span>=</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;            rand() % num_classes;  <span class="comment">// select a random class for the point</span></div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160; </div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;        <span class="comment">// create random coordinates (x,y,z) around the centre of the class</span></div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;        <a class="code" href="../../df/dea/structdata.html">data</a>[i][0] = <a class="code" href="../../d2/df6/kohonen__som__topology_8c.html#af5ce14f026d6d231bef29161bac2b485">_random</a>(centres[<span class="keyword">class</span>][0] - R, centres[<span class="keyword">class</span>][0] + R);</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;        <a class="code" href="../../df/dea/structdata.html">data</a>[i][1] = <a class="code" href="../../d2/df6/kohonen__som__topology_8c.html#af5ce14f026d6d231bef29161bac2b485">_random</a>(centres[<span class="keyword">class</span>][1] - R, centres[<span class="keyword">class</span>][1] + R);</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160; </div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;        <span class="comment">/* The follosing can also be used</span></div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;<span class="comment">        for (int j = 0; j &lt; 2; j++)</span></div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;<span class="comment">            data[i][j] = _random(centres[class][j] - R, centres[class][j] + R);</span></div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;<span class="comment">        */</span></div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;    }</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="../../d2/df6/kohonen__som__topology_8c_adb5ded007be1fd666fab9affe6764018_cgraph.svg" width="248" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="ad9e25202bb8b481461f932668f249dbc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad9e25202bb8b481461f932668f249dbc">&#9670;&nbsp;</a></span>test_3d_classes1()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void test_3d_classes1 </td>
          <td>(</td>
          <td class="paramtype">double *const *&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>N</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Creates a random set of points distributed in four clusters in 3D space with centroids at the points. </p>
<ul>
<li>\((0,5, 0.5, 0.5)\)</li>
<li>\((0,5,-0.5, -0.5)\)</li>
<li>\((-0,5, 0.5, 0.5)\)</li>
<li>\((-0,5,-0.5, -0.5)\)</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">data</td><td>matrix to store data in </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">N</td><td>number of points required </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;{</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> R = 0.2;  <span class="comment">// radius of cluster</span></div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;    <span class="keywordtype">int</span> i;</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> num_classes = 4;</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> centres[][3] = {</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;        <span class="comment">// centres of each class cluster</span></div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;        {.5, .5, .5},    <span class="comment">// centre of class 1</span></div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;        {.5, -.5, -.5},  <span class="comment">// centre of class 2</span></div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;        {-.5, .5, .5},   <span class="comment">// centre of class 3</span></div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;        {-.5, -.5 - .5}  <span class="comment">// centre of class 4</span></div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;    };</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160; </div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;<span class="preprocessor">#ifdef _OPENMP</span></div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;<span class="preprocessor">#pragma omp for</span></div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;    <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="../../db/d01/problem__13_2sol1_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>; i++)</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;    {</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;        <span class="keywordtype">int</span> <span class="keyword">class </span>=</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;            rand() % num_classes;  <span class="comment">// select a random class for the point</span></div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160; </div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;        <span class="comment">// create random coordinates (x,y,z) around the centre of the class</span></div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;        <a class="code" href="../../df/dea/structdata.html">data</a>[i][0] = <a class="code" href="../../d2/df6/kohonen__som__topology_8c.html#af5ce14f026d6d231bef29161bac2b485">_random</a>(centres[<span class="keyword">class</span>][0] - R, centres[<span class="keyword">class</span>][0] + R);</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;        <a class="code" href="../../df/dea/structdata.html">data</a>[i][1] = <a class="code" href="../../d2/df6/kohonen__som__topology_8c.html#af5ce14f026d6d231bef29161bac2b485">_random</a>(centres[<span class="keyword">class</span>][1] - R, centres[<span class="keyword">class</span>][1] + R);</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;        <a class="code" href="../../df/dea/structdata.html">data</a>[i][2] = <a class="code" href="../../d2/df6/kohonen__som__topology_8c.html#af5ce14f026d6d231bef29161bac2b485">_random</a>(centres[<span class="keyword">class</span>][2] - R, centres[<span class="keyword">class</span>][2] + R);</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160; </div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;        <span class="comment">/* The follosing can also be used</span></div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;<span class="comment">        for (int j = 0; j &lt; 3; j++)</span></div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;<span class="comment">            data[i][j] = _random(centres[class][j] - R, centres[class][j] + R);</span></div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;<span class="comment">        */</span></div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;    }</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="../../d2/df6/kohonen__som__topology_8c_ad9e25202bb8b481461f932668f249dbc_cgraph.svg" width="255" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a5bb02a8322d717ead1b11182c5f02a3a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5bb02a8322d717ead1b11182c5f02a3a">&#9670;&nbsp;</a></span>test_3d_classes2()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void test_3d_classes2 </td>
          <td>(</td>
          <td class="paramtype">double *const *&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>N</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Creates a random set of points distributed in four clusters in 3D space with centroids at the points. </p>
<ul>
<li>\((0,5, 0.5, 0.5)\)</li>
<li>\((0,5,-0.5, -0.5)\)</li>
<li>\((-0,5, 0.5, 0.5)\)</li>
<li>\((-0,5,-0.5, -0.5)\)</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">data</td><td>matrix to store data in </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">N</td><td>number of points required </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;{</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> R = 0.2;  <span class="comment">// radius of cluster</span></div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;    <span class="keywordtype">int</span> i;</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> num_classes = 8;</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> centres[][3] = {</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;        <span class="comment">// centres of each class cluster</span></div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;        {.5, .5, .5},    <span class="comment">// centre of class 1</span></div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;        {.5, .5, -.5},   <span class="comment">// centre of class 2</span></div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;        {.5, -.5, .5},   <span class="comment">// centre of class 3</span></div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;        {.5, -.5, -.5},  <span class="comment">// centre of class 4</span></div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;        {-.5, .5, .5},   <span class="comment">// centre of class 5</span></div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;        {-.5, .5, -.5},  <span class="comment">// centre of class 6</span></div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;        {-.5, -.5, .5},  <span class="comment">// centre of class 7</span></div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;        {-.5, -.5, -.5}  <span class="comment">// centre of class 8</span></div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;    };</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160; </div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;<span class="preprocessor">#ifdef _OPENMP</span></div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;<span class="preprocessor">#pragma omp for</span></div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;    <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="../../db/d01/problem__13_2sol1_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a>; i++)</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;    {</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;        <span class="keywordtype">int</span> <span class="keyword">class </span>=</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;            rand() % num_classes;  <span class="comment">// select a random class for the point</span></div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160; </div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;        <span class="comment">// create random coordinates (x,y,z) around the centre of the class</span></div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;        <a class="code" href="../../df/dea/structdata.html">data</a>[i][0] = <a class="code" href="../../d2/df6/kohonen__som__topology_8c.html#af5ce14f026d6d231bef29161bac2b485">_random</a>(centres[<span class="keyword">class</span>][0] - R, centres[<span class="keyword">class</span>][0] + R);</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;        <a class="code" href="../../df/dea/structdata.html">data</a>[i][1] = <a class="code" href="../../d2/df6/kohonen__som__topology_8c.html#af5ce14f026d6d231bef29161bac2b485">_random</a>(centres[<span class="keyword">class</span>][1] - R, centres[<span class="keyword">class</span>][1] + R);</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;        <a class="code" href="../../df/dea/structdata.html">data</a>[i][2] = <a class="code" href="../../d2/df6/kohonen__som__topology_8c.html#af5ce14f026d6d231bef29161bac2b485">_random</a>(centres[<span class="keyword">class</span>][2] - R, centres[<span class="keyword">class</span>][2] + R);</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160; </div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;        <span class="comment">/* The follosing can also be used</span></div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;<span class="comment">        for (int j = 0; j &lt; 3; j++)</span></div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;<span class="comment">            data[i][j] = _random(centres[class][j] - R, centres[class][j] + R);</span></div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;<span class="comment">        */</span></div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;    }</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="../../d2/df6/kohonen__som__topology_8c_a5bb02a8322d717ead1b11182c5f02a3a_cgraph.svg" width="255" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="ad139de302fa8135a433d9c1bf971b13b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad139de302fa8135a433d9c1bf971b13b">&#9670;&nbsp;</a></span>update_weights()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double update_weights </td>
          <td>(</td>
          <td class="paramtype">const double *&#160;</td>
          <td class="paramname"><em>X</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="../../d0/dc8/structarray__3d.html">array_3d</a> *&#160;</td>
          <td class="paramname"><em>W</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double **&#160;</td>
          <td class="paramname"><em>D</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>num_out</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>num_features</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>alpha</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>R</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Update weights of the SOM using Kohonen algorithm. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">X</td><td>data point </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">W</td><td>weights matrix </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">D</td><td>temporary vector to store distances </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">num_out</td><td>number of output points </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">num_features</td><td>number of features per input sample </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">alpha</td><td>learning rate \(0&lt;\alpha\le1\) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">R</td><td>neighborhood range </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>minimum distance of sample and trained weights </dd></dl>
<div class="fragment"><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;{</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;    <span class="keywordtype">int</span> x, y, k;</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;    <span class="keywordtype">double</span> d_min = 0.f;</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160; </div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;<span class="preprocessor">#ifdef _OPENMP</span></div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;<span class="preprocessor">#pragma omp for</span></div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    <span class="comment">// step 1: for each 2D output point</span></div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    <span class="keywordflow">for</span> (x = 0; x &lt; num_out; x++)</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    {</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;        <span class="keywordflow">for</span> (y = 0; y &lt; num_out; y++)</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;        {</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;            D[x][y] = 0.f;</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;            <span class="comment">// compute Euclidian distance of each output</span></div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;            <span class="comment">// point from the current sample</span></div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;            <span class="keywordflow">for</span> (k = 0; k &lt; num_features; k++)</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;            {</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;                <span class="keywordtype">double</span> *w = <a class="code" href="../../d2/df6/kohonen__som__topology_8c.html#a7237d2cf3b3f9d034477268c1d6631da">data_3d</a>(W, x, y, k);</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;                D[x][y] += (w[0] - X[k]) * (w[0] - X[k]);</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;            }</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;            D[x][y] = sqrt(D[x][y]);</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;        }</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;    }</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160; </div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    <span class="comment">// step 2:  get closest node i.e., node with smallest Euclidian distance to</span></div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;    <span class="comment">// the current pattern</span></div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;    <span class="keywordtype">int</span> d_min_x, d_min_y;</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    <a class="code" href="../../d2/df6/kohonen__som__topology_8c.html#adc22d512c00a9f5799ee067f4fb90b4b">get_min_2d</a>(D, num_out, &amp;d_min, &amp;d_min_x, &amp;d_min_y);</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160; </div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;    <span class="comment">// step 3a: get the neighborhood range</span></div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    <span class="keywordtype">int</span> from_x = <a class="code" href="../../d2/df6/kohonen__som__topology_8c.html#affe776513b24d84b39af8ab0930fef7f">max</a>(0, d_min_x - R);</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    <span class="keywordtype">int</span> to_x = <a class="code" href="../../d2/df6/kohonen__som__topology_8c.html#ac6afabdc09a49a433ee19d8a9486056d">min</a>(num_out, d_min_x + R + 1);</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    <span class="keywordtype">int</span> from_y = <a class="code" href="../../d2/df6/kohonen__som__topology_8c.html#affe776513b24d84b39af8ab0930fef7f">max</a>(0, d_min_y - R);</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    <span class="keywordtype">int</span> to_y = <a class="code" href="../../d2/df6/kohonen__som__topology_8c.html#ac6afabdc09a49a433ee19d8a9486056d">min</a>(num_out, d_min_y + R + 1);</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160; </div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    <span class="comment">// step 3b: update the weights of nodes in the</span></div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    <span class="comment">// neighborhood</span></div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;<span class="preprocessor">#ifdef _OPENMP</span></div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;<span class="preprocessor">#pragma omp for</span></div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;    <span class="keywordflow">for</span> (x = from_x; x &lt; to_x; x++)</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;    {</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;        <span class="keywordflow">for</span> (y = from_y; y &lt; to_y; y++)</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;        {</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;            <span class="comment">/* you can enable the following normalization if needed.</span></div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;<span class="comment">               personally, I found it detrimental to convergence */</span></div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;            <span class="comment">// const double s2pi = sqrt(2.f * M_PI);</span></div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;            <span class="comment">// double normalize = 1.f / (alpha * s2pi);</span></div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160; </div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;            <span class="comment">/* apply scaling inversely proportional to distance from the</span></div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;<span class="comment">               current node */</span></div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;            <span class="keywordtype">double</span> d2 =</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;                (d_min_x - x) * (d_min_x - x) + (d_min_y - y) * (d_min_y - y);</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;            <span class="keywordtype">double</span> scale_factor = exp(-d2 / (2.f * alpha * alpha));</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160; </div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;            <span class="keywordflow">for</span> (k = 0; k &lt; num_features; k++)</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;            {</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;                <span class="keywordtype">double</span> *w = <a class="code" href="../../d2/df6/kohonen__som__topology_8c.html#a7237d2cf3b3f9d034477268c1d6631da">data_3d</a>(W, x, y, k);</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;                <span class="comment">// update weights of nodes in the neighborhood</span></div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;                w[0] += alpha * scale_factor * (X[k] - w[0]);</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;            }</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;        }</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    }</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;    <span class="keywordflow">return</span> d_min;</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="../../d2/df6/kohonen__som__topology_8c_ad139de302fa8135a433d9c1bf971b13b_cgraph.svg" width="262" height="88"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<div class="ttc" id="akohonen__som__topology_8c_html_ac6afabdc09a49a433ee19d8a9486056d"><div class="ttname"><a href="../../d2/df6/kohonen__som__topology_8c.html#ac6afabdc09a49a433ee19d8a9486056d">min</a></div><div class="ttdeci">#define min(a, b)</div><div class="ttdoc">shorthand for minimum value</div><div class="ttdef"><b>Definition:</b> kohonen_som_topology.c:36</div></div>
<div class="ttc" id="akohonen__som__topology_8c_html_ad139de302fa8135a433d9c1bf971b13b"><div class="ttname"><a href="../../d2/df6/kohonen__som__topology_8c.html#ad139de302fa8135a433d9c1bf971b13b">update_weights</a></div><div class="ttdeci">double update_weights(const double *X, struct array_3d *W, double **D, int num_out, int num_features, double alpha, int R)</div><div class="ttdoc">Update weights of the SOM using Kohonen algorithm.</div><div class="ttdef"><b>Definition:</b> kohonen_som_topology.c:227</div></div>
<div class="ttc" id="astructarray__3d_html_ac8967b2c72769f839c09fb4cebb4339f"><div class="ttname"><a href="../../d0/dc8/structarray__3d.html#ac8967b2c72769f839c09fb4cebb4339f">array_3d::data</a></div><div class="ttdeci">double * data</div><div class="ttdoc">pointer to data</div><div class="ttdef"><b>Definition:</b> kohonen_som_topology.c:45</div></div>
<div class="ttc" id="astructdata_html"><div class="ttname"><a href="../../df/dea/structdata.html">data</a></div><div class="ttdef"><b>Definition:</b> prime_factoriziation.c:25</div></div>
<div class="ttc" id="akohonen__som__topology_8c_html_a7237d2cf3b3f9d034477268c1d6631da"><div class="ttname"><a href="../../d2/df6/kohonen__som__topology_8c.html#a7237d2cf3b3f9d034477268c1d6631da">data_3d</a></div><div class="ttdeci">double * data_3d(const struct array_3d *arr, int x, int y, int z)</div><div class="ttdoc">Function that returns the pointer to (x, y, z) ^th location in the linear 3D array given by:</div><div class="ttdef"><b>Definition:</b> kohonen_som_topology.c:60</div></div>
<div class="ttc" id="akohonen__som__topology_8c_html_ad9e25202bb8b481461f932668f249dbc"><div class="ttname"><a href="../../d2/df6/kohonen__som__topology_8c.html#ad9e25202bb8b481461f932668f249dbc">test_3d_classes1</a></div><div class="ttdeci">void test_3d_classes1(double *const *data, int N)</div><div class="ttdoc">Creates a random set of points distributed in four clusters in 3D space with centroids at the points.</div><div class="ttdef"><b>Definition:</b> kohonen_som_topology.c:452</div></div>
<div class="ttc" id="akohonen__som__topology_8c_html_a5bb02a8322d717ead1b11182c5f02a3a"><div class="ttname"><a href="../../d2/df6/kohonen__som__topology_8c.html#a5bb02a8322d717ead1b11182c5f02a3a">test_3d_classes2</a></div><div class="ttdeci">void test_3d_classes2(double *const *data, int N)</div><div class="ttdoc">Creates a random set of points distributed in four clusters in 3D space with centroids at the points.</div><div class="ttdef"><b>Definition:</b> kohonen_som_topology.c:551</div></div>
<div class="ttc" id="aproblem__13_2sol1_8c_html_a0240ac851181b84ac374872dc5434ee4"><div class="ttname"><a href="../../db/d01/problem__13_2sol1_8c.html#a0240ac851181b84ac374872dc5434ee4">N</a></div><div class="ttdeci">#define N</div><div class="ttdoc">number of digits of the large number</div><div class="ttdef"><b>Definition:</b> sol1.c:109</div></div>
<div class="ttc" id="akohonen__som__topology_8c_html_adee1bc3871c881f6e04cb9e0b1d01158"><div class="ttname"><a href="../../d2/df6/kohonen__som__topology_8c.html#adee1bc3871c881f6e04cb9e0b1d01158">save_u_matrix</a></div><div class="ttdeci">int save_u_matrix(const char *fname, struct array_3d *W)</div><div class="ttdoc">Create the distance matrix or U-matrix from the trained weights and save to disk.</div><div class="ttdef"><b>Definition:</b> kohonen_som_topology.c:132</div></div>
<div class="ttc" id="astructarray__3d_html_ad823bd5424a0fc158da52a0497d8c10a"><div class="ttname"><a href="../../d0/dc8/structarray__3d.html#ad823bd5424a0fc158da52a0497d8c10a">array_3d::dim3</a></div><div class="ttdeci">int dim3</div><div class="ttdoc">lengths of thirddimension</div><div class="ttdef"><b>Definition:</b> kohonen_som_topology.c:44</div></div>
<div class="ttc" id="astructarray__3d_html_ad5d3ee546eea3c05dc8f0dc90ec194f4"><div class="ttname"><a href="../../d0/dc8/structarray__3d.html#ad5d3ee546eea3c05dc8f0dc90ec194f4">array_3d::dim1</a></div><div class="ttdeci">int dim1</div><div class="ttdoc">lengths of first dimension</div><div class="ttdef"><b>Definition:</b> kohonen_som_topology.c:42</div></div>
<div class="ttc" id="akohonen__som__topology_8c_html_adc22d512c00a9f5799ee067f4fb90b4b"><div class="ttname"><a href="../../d2/df6/kohonen__som__topology_8c.html#adc22d512c00a9f5799ee067f4fb90b4b">get_min_2d</a></div><div class="ttdeci">void get_min_2d(double **X, int N, double *val, int *x_idx, int *y_idx)</div><div class="ttdoc">Get minimum value and index of the value in a matrix.</div><div class="ttdef"><b>Definition:</b> kohonen_som_topology.c:197</div></div>
<div class="ttc" id="akohonen__som__topology_8c_html_af5ce14f026d6d231bef29161bac2b485"><div class="ttname"><a href="../../d2/df6/kohonen__som__topology_8c.html#af5ce14f026d6d231bef29161bac2b485">_random</a></div><div class="ttdeci">double _random(double a, double b)</div><div class="ttdoc">Helper function to generate a random number in a given interval.</div><div class="ttdef"><b>Definition:</b> kohonen_som_topology.c:80</div></div>
<div class="ttc" id="astructarray__3d_html"><div class="ttname"><a href="../../d0/dc8/structarray__3d.html">array_3d</a></div><div class="ttdoc">to store info regarding 3D arrays</div><div class="ttdef"><b>Definition:</b> kohonen_som_topology.c:41</div></div>
<div class="ttc" id="akohonen__som__topology_8c_html_a6824dc6d973eb3339af7aef5fea78b0c"><div class="ttname"><a href="../../d2/df6/kohonen__som__topology_8c.html#a6824dc6d973eb3339af7aef5fea78b0c">save_2d_data</a></div><div class="ttdeci">int save_2d_data(const char *fname, double **X, int num_points, int num_features)</div><div class="ttdoc">Save a given n-dimensional data martix to file.</div><div class="ttdef"><b>Definition:</b> kohonen_som_topology.c:95</div></div>
<div class="ttc" id="akohonen__som__topology_8c_html_affe776513b24d84b39af8ab0930fef7f"><div class="ttname"><a href="../../d2/df6/kohonen__som__topology_8c.html#affe776513b24d84b39af8ab0930fef7f">max</a></div><div class="ttdeci">#define max(a, b)</div><div class="ttdoc">shorthand for maximum value</div><div class="ttdef"><b>Definition:</b> kohonen_som_topology.c:32</div></div>
<div class="ttc" id="astructarray__3d_html_aa431cc0a41fd379270dbd2b0e3ac1b45"><div class="ttname"><a href="../../d0/dc8/structarray__3d.html#aa431cc0a41fd379270dbd2b0e3ac1b45">array_3d::dim2</a></div><div class="ttdeci">int dim2</div><div class="ttdoc">lengths of second dimension</div><div class="ttdef"><b>Definition:</b> kohonen_som_topology.c:43</div></div>
<div class="ttc" id="akohonen__som__topology_8c_html_a1983dc0f35e734015772e9f8c0ff19f5"><div class="ttname"><a href="../../d2/df6/kohonen__som__topology_8c.html#a1983dc0f35e734015772e9f8c0ff19f5">kohonen_som</a></div><div class="ttdeci">void kohonen_som(double **X, struct array_3d *W, int num_samples, int num_features, int num_out, double alpha_min)</div><div class="ttdoc">Apply incremental algorithm with updating neighborhood and learning rates on all samples in the given...</div><div class="ttdef"><b>Definition:</b> kohonen_som_topology.c:306</div></div>
<div class="ttc" id="akohonen__som__topology_8c_html_adb5ded007be1fd666fab9affe6764018"><div class="ttname"><a href="../../d2/df6/kohonen__som__topology_8c.html#adb5ded007be1fd666fab9affe6764018">test_2d_classes</a></div><div class="ttdeci">void test_2d_classes(double *const *data, int N)</div><div class="ttdoc">Creates a random set of points distributed in four clusters in 3D space with centroids at the points.</div><div class="ttdef"><b>Definition:</b> kohonen_som_topology.c:353</div></div>
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../dir_3343723ae086de42ee4ca9774da3a13f.html">machine_learning</a></li><li class="navelem"><a class="el" href="../../d2/df6/kohonen__som__topology_8c.html">kohonen_som_topology.c</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.18 </li>
  </ul>
</div>
</body>
</html>
